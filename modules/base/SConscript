Import('env')
import scons_tools.dependency
import scons_tools.dependency.boost
import scons_tools.dependency.gcc

# could use env.Command
env.Execute("%s --output=\"%s\" --datapath=\"%s\" --examplepath=\"%s\""\
            %(File("#/scons_tools/build_tools/setup_paths.py").abspath,
              File("#/build/src/base/paths.cpp").abspath, env['datadir'],
              env['docdir']+"/examples"))


deplist=[]

scons_tools.dependency.boost.add_boost_library(env, "FileSystem", "filesystem",
                                               'boost/filesystem/path.hpp',
                                               body="boost::filesystem::path p;",
                                               extra_boost_libs=["system"])
scons_tools.dependency.boost.add_boost_library(env, "ProgramOptions", "program_options",
                                               'boost/program_options.hpp')
scons_tools.dependency.add_external_library(env, "GPerfTools",
                                            ["profiler"],
                                            "gperftools/profiler.h",
                                            body='ProfilerStop();')

# TCMalloc needs to be used by passing
# environment="LD_PRELOAD=/usr/lib64/libtcmalloc_and_profiler.so"
# in your config to ensure that it is used for all libraries that are loaded
# otherwise memory that is freed in IMP, but allocated within another .so
# causes problems
scons_tools.dependency.add_external_library(env, "tcmalloc_heapchecker",
                                            None,
                                            header="gperftools/heap-checker.h",
                                            body="new HeapLeakChecker(\"profiler\");")

scons_tools.dependency.add_external_library(env, "tcmalloc_heapprofiler",
                                            None,
                                            header="gperftools/heap-profiler.h",
                                            body="HeapProfilerStart(\"profiler\");")

scons_tools.dependency.add_external_library(env, "log4cxx",
                                            ["log4cxx"],
                                            header="log4cxx/ndc.h")

env.IMPModuleBuild()
