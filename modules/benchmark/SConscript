Import('env')
import scons_tools.data

import scons_tools

config=[]
if scons_tools.data.get(env).dependencies["tcmalloc"].ok:
    config.append(["IMP_BENCHMARK_USE_TCMALLOC", 1])
else:
    config.append(["IMP_BENCHMARK_NO_TCMALLOC", 1])


scons_tools.dependency.add_external_library(env, "GPerfTools",
                                            ["profiler"],
                                            "gperftools/profiler.h",
                                            body='ProfilerStop();')
# don't bother checking for the old one if the new one is found
if not env.GetOption('help') and not env.GetOption('clean') \
   and not scons_tools.data.get(env).dependencies["GPerfTools"].ok:
    scons_tools.dependency.add_external_library(env, "GooglePerfTools",
                                                ["profiler"],
                                                "google/profiler.h",
                                                body='ProfilerStop();')
else:
    scons_tools.data.get(env).add_dependency("GooglePerfTools", ok=False)


scons_tools.dependency.boost.add_boost_library(env, "ProgramOptions",
                                               "program_options",
                                               'boost/program_options.hpp',
                                               extra_boost_libs=["system"])

module_env=env.IMPModuleBuild(version='nightly-21/6/2012',
                              required_modules=['base'],
                              optional_dependencies
                              =['GPerfTools',
                                'GooglePerfTools',
                                'Boost.ProgramOptions'],
                              config_macros=config)
