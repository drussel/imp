/**
 *  \file FilteredListPairContainer.cpp
 *  \brief Simple xyzr decorator.
 *
 *  This file is generated by a script (core/tools/make-container).
 *  Do not edit directly.
 *
 *  Copyright 2007-9 Sali Lab. All rights reserved.
 *
 */

#include "IMP/core/FilteredListPairContainer.h"
#include <algorithm>


IMPCORE_BEGIN_NAMESPACE

namespace {

  class Found {
    typedef FilteredListPairContainer
    ::PairFilterConstIterator It;
    It b_,e_;
  public:
    Found(It b,
          It e):
      b_(b), e_(e){}
    bool operator()(ParticlePair vt) const {
      for (It c=b_; c != e_; ++c) {
        if ((*c)->get_contains_particle_pair(vt)) return true;
      }
      return false;
    }
  };

}

FilteredListPairContainer
::FilteredListPairContainer(): sorted_(true){
}

void FilteredListPairContainer::add_particle_pair(ParticlePair vt) {
  IMP_CHECK_OBJECT(this);
  // For VC which can't convert the iterators
  const FilteredListPairContainer *cthis=
    const_cast<const FilteredListPairContainer*>(this);
  if (!Found(cthis->pair_filters_begin(),
             cthis->pair_filters_end())(vt)) {
    data_.push_back(vt);
    if (sorted_) {
      std::sort(data_.begin(), data_.end());
    }
  }
}

bool
FilteredListPairContainer
::get_contains_particle_pair(ParticlePair vt) const {
  IMP_check(sorted_, "Cannot check if the container contains an object "
            << "while you are editing it.", InvalidStateException);
  return std::binary_search(particle_pairs_begin(),
                            particle_pairs_end(), vt);
}

void FilteredListPairContainer::show(std::ostream &out) const {
  IMP_CHECK_OBJECT(this);
  out << "FilteredListPairContainer with "
      << get_number_of_particle_pairs()
      << " particle_pairs." << std::endl;
}


void FilteredListPairContainer::set_is_editing(bool tf) {
  if (tf== !sorted_) return;
  else {
    sorted_=!tf;
    if (sorted_) {
      std::sort(data_.begin(), data_.end());
    }
  }
}

unsigned int
FilteredListPairContainer::get_number_of_particle_pairs() const {
  return data_.size();
}

ParticlePair
FilteredListPairContainer::get_particle_pair(unsigned int i) const {
  IMP_check(i < get_number_of_particle_pairs(),
            "Out of range " << i << " for array of size " << data_.size(),
            IndexException);
  return data_[i];
}


IMP_LIST_IMPL(FilteredListPairContainer,
              PairFilter,
              pair_filter,
              PairContainer*,
              PairContainers,,,)

IMPCORE_END_NAMESPACE
