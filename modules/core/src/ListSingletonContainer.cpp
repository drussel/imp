/**
 *  \file ListSingletonContainer.cpp   \brief A list of Particles.
 *
 *  This file is generated by a script (core/tools/make-container).
 *  Do not edit directly.
 *
 *  Copyright 2007-9 Sali Lab. All rights reserved.
 *
 */

#include "IMP/core/ListSingletonContainer.h"
#include "IMP/SingletonModifier.h"
#include "IMP/SingletonScore.h"
#include <algorithm>


IMPCORE_BEGIN_NAMESPACE

ListSingletonContainer
::ListSingletonContainer(const Particles &ps,
                         std::string name):
  SingletonContainer(name){
  sorted_=false;
  rev_=0;
  set_particles(ps);
  set_is_editing(false);
}

ListSingletonContainer
::ListSingletonContainer(std::string name):
  SingletonContainer(name){
  sorted_=true;
  rev_=0;
}


IMP_LIST_IMPL(ListSingletonContainer, Particle,
              particle, Particle*,Particles,, {
                if (sorted_) std::sort(particles_begin(),
                                       particles_end());
                ++rev_;
              },++rev_);


void ListSingletonContainer::set_is_editing(bool tf) {
  if (tf== !sorted_) return;
  else {
    sorted_=!tf;
    if (sorted_) {
      std::sort(particles_begin(), particles_end());
      ++rev_;
    }
  }
}


bool
ListSingletonContainer::get_contains_particle(Particle* vt) const {
  IMP_CHECK_OBJECT(this);
  return std::binary_search(particles_begin(), particles_end(), vt);
}

void ListSingletonContainer::show(std::ostream &out) const {
  IMP_CHECK_OBJECT(this);
  out << "ListSingletonContainer with " << get_number_of_particles()
      << " particles." << std::endl;
}

void ListSingletonContainer::apply(const SingletonModifier *sm) {
  sm->apply(access_particles());
}

void ListSingletonContainer::apply(const SingletonModifier *sm,
                               DerivativeAccumulator &da) {
  sm->apply(access_particles(), da);
}

double ListSingletonContainer::evaluate(const SingletonScore *s,
                                        DerivativeAccumulator *da) const {
  return s->evaluate(access_particles(), da);
}


ParticlesTemp ListSingletonContainer::get_particles() const {
  return access_particles();
}

unsigned int ListSingletonContainer::get_revision() const {
  return rev_;
}

IMPCORE_END_NAMESPACE
