/**
 *  \file core/internal/CoreClosePairContainer.h
 *  \brief Return all pairs from a SingletonContainer
 *
 *  This file is generated by a script (core/tools/make-container).
 *  Do not edit directly.
 *
 *  Copyright 2007-2010 IMP Inventors. Close rights reserved.
 */

#ifndef IMPCORE_INTERNAL_CORE_CLOSE_PAIR_CONTAINER_H
#define IMPCORE_INTERNAL_CORE_CLOSE_PAIR_CONTAINER_H

#include "../core_config.h"
#include "../ClosePairsFinder.h"
#include "MovedSingletonContainer.h"
#include <IMP/PairContainer.h>
#include <IMP/PairFilter.h>
#include <IMP/SingletonContainer.h>
#include "pair_helpers.h"

IMPCORE_BEGIN_INTERNAL_NAMESPACE


class IMPCOREEXPORT CoreClosePairContainer :
public internal::ListLikePairContainer
{
  IMP::internal::OwnerPointer<SingletonContainer> c_;
  IMP::internal::OwnerPointer<ClosePairsFinder> cpf_;
  IMP::internal::OwnerPointer<internal::MovedSingletonContainer> moved_;
  bool first_call_;
  double distance_, slack_;
  ParticlePairsTemp data_;
  IMP_CONTAINER_DEPENDENCIES(CoreClosePairContainer,
                             {
                             ret= back_->cpf_->get_input_containers(back_->c_);
                             ret.push_back(back_->moved_);
    });
  IMP_ACTIVE_CONTAINER_DECL(CoreClosePairContainer);
  void initialize(SingletonContainer *c, double distance,
                  double slack, ClosePairsFinder *cpf);
public:
  CoreClosePairContainer(SingletonContainer *c, double distance,
                         ClosePairsFinder *cpf,
                         double slack=1);

  IMP_LIST(public, PairFilter, pair_filter,
           PairFilter*, PairFilters);
#ifndef IMP_DOXYGEN
  bool get_is_up_to_date() const {
    if (get_model()->get_stage() != Model::NOT_EVALUATING) {
      return get_last_update_evaluation() == get_model()->get_evaluation();
    } else {
      if (!c_->get_is_up_to_date()) return false;
      bool ret=true;
      IMP_FOREACH_SINGLETON(c_,
                            ret= !(imp_foreach_break
                                   =_1->get_is_changed()););
      return ret;
    }
  }
#endif
  IMP_LISTLIKE_PAIR_CONTAINER(CoreClosePairContainer);
};


IMPCORE_END_INTERNAL_NAMESPACE

#endif  /* IMPCORE_INTERNAL_CORE_CLOSE_PAIR_CONTAINER_H */
