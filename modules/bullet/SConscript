Import('env')
import scons_tools.dependency
import scons_tools.bug_fixes

scons_tools.dependency.add_external_library(env, "Bullet", ["BulletDynamics", "BulletCollision",
                                                        "BulletSoftBody",
                                                        "LinearMath"],
                                       "btBulletDynamicsCommon.h",
                                        body="""btBroadphaseInterface* broadphase = new btDbvtBroadphase();""",
                                        extra_libs=[])

cenv= scons_tools.bug_fixes.clone_env(env)
conf = cenv.Configure(custom_tests={})
if conf.CheckHeader("LinearMath/btScalar.h", language="C++"):
    cppdefines=[]
else:
    cppdefines=["IMP_BULLET_SUBDIR"]
conf.Finish()

env.IMPModuleBuild(version='SVN',
                   required_modules=['container', 'cgal'],
                   optional_modules=[],
                   lib_only_required_modules=['atom', 'domino'],
                   required_dependencies=["Bullet"])
