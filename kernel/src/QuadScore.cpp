/**
 *  \file QuadScore.cpp  \brief Define QuadScore
 *
 *  This file is generated by a script (core/tools/make-container).
 *  Do not edit directly.
 *
 *  Copyright 2007-2011 IMP Inventors. All rights reserved.
 */

#include <IMP/QuadScore.h>
#include <IMP/internal/utility.h>
#include <IMP/Restraint.h>
#include <IMP/macros.h>
#include <IMP/QuadScore.h>
#include <IMP/internal/container_helpers.h>
IMP_BEGIN_NAMESPACE

QuadScore::QuadScore(std::string name):
  Object(name)
{
  /* Implemented here rather than in the header so that PairScore
     symbols are present in the kernel DSO */
}

QuadScoreRestraint::QuadScoreRestraint(std::string name):
  Restraint(name){}

QuadsScoreRestraint::QuadsScoreRestraint(std::string name):
  Restraint(name){}


namespace {


  class QuadRestraint :
    public QuadScoreRestraint
  {
    IMP::OwnerPointer<QuadScore> ss_;
    ParticleQuad v_;
  public:
    //! Create the restraint.
    /** This function takes the function to apply to the
        stored Quad and the Quad.
    */
    QuadRestraint(QuadScore *ss,
                       const ParticleQuad& vt,
                       std::string name);

    QuadScore* get_score() const {
      return ss_;
    }
    ParticleQuad get_argument() const {
      return v_;
    }

    IMP_RESTRAINT(QuadRestraint);
  };

  QuadRestraint
  ::QuadRestraint(QuadScore *ss,
                       const ParticleQuad& vt,
                       std::string name):
    QuadScoreRestraint(name),
    ss_(ss),
    v_(vt)
  {
  }

  double QuadRestraint
  ::unprotected_evaluate(DerivativeAccumulator *accum) const
  {
    IMP_OBJECT_LOG;
    IMP_CHECK_OBJECT(ss_);
    return ss_->evaluate(v_, accum);
  }

  ParticlesTemp QuadRestraint::get_input_particles() const
  {
    return IMP::internal::get_input_particles(ss_.get(), v_);
  }

  ContainersTemp QuadRestraint::get_input_containers() const
  {
    return IMP::internal::get_input_containers(ss_.get(), v_);
  }

  void QuadRestraint::do_show(std::ostream& out) const
  {
    out << "score " << ss_->get_name() << std::endl;
    out << "data " << IMP::internal::streamable(v_) << std::endl;
  }
}


Restraints
QuadScore
::get_current_decomposition(const ParticleQuad& vt) const {
  return Restraints(1,
                    new QuadRestraint(const_cast<QuadScore*>(this),
                                           vt,
                                           get_name()));
}

IMP_END_NAMESPACE
