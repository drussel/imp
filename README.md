Pull lots of the non-iteresting setup work out of scons as scons is slow and
doesn't do a very good job at it.
